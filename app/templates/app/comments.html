{% extends 'base.html' %}

{% block title %}Comentarios{% endblock %}

{% block content %}
<div style="margin: 5%">
    {% if admin_comments %}
    <table style="width: 100%">
        <tr>
            <th style="width: 20%">Evento</th>
            <th style="width: 20%">Usuario</th>
            <th style="width: 35%">Comentario</th>
            <th style="width: 15%">Fecha</th>
            <th style="width: 10%">Acciones</th>
        </tr>
        {% for comment in admin_comments %}
        <tr>
            <td><a href="{% url 'event_detail' comment.event.id %}">{{ comment.event.title }}</a></td>
            <td>{{ comment.user.username }}</td>
            <td>{{ comment.title }}</td>
            <td>{{ comment.created_at }}</td>
            <td><button onclick="javascript:viewComment(this, '{% url 'admin_delete_comment' comment.id %}');"
                data-username="{{ comment.user.username }}"
                data-created="{{ comment.created_at }} "
                data-title="{{ comment.title }}"
                data-text="{{ comment.text|escapejs }}"><i class="bi bi-eye" aria-hidden="true" style="color: lightblue;"></i></button>
                <button onclick="javascript:deleteComment('{% url 'admin_delete_comment' comment.id %}')"><i class="bi bi-trash" aria-hidden="true" style="color: red;"></i></button></td>
        </tr>
        {% endfor %}
    </table>
    <div id="show" style="display: none; margin-top: 2%; border: 1px solid lightgray; padding: 10px">
        <div class="d-flex justify-content-between align-items-center">
            <h id="show_username" style="font-weight: bold"></h>
            <div style= "position: relative;">
                <button onclick="openModal()"><i class="bi bi-trash" aria-hidden="true" style="color: red;"></i></button></td>
            </div>
        </div>
        <p style="font-size: 10px" id="show_created"></p>
        <h id="show_title" style="font-weight: bold"></h>
        <P id="show_text"></p>
    </div>

    {% else %}
        <p>No hay comentarios en los eventos que usted ha creado.</p>
    {% endif %}

</div>
<div id="deleteModal" style="display: none;">
    <div class="modal-content">
        <h2>¿Está seguro que desea eliminar el comentario?</h2>
        <form id="deleteForm" style="display= none;"  method="POST">
            {% csrf_token %}
            <button onclick="submitForm()" style="background-color: red; border: none; color: white; padding: 5px 10px; border-radius: 5px;">Eliminar</button>
            <button onclick="closeModal()" style="background-color: #0a6efa; color: white; border: none; padding: 5px 10px; border-radius: 5px;" type= "button">Cancelar</button>
        </form>
    </div>
</div> 

<script>
    function viewComment(button, url){
        document.getElementById("show_username").innerText = button.dataset.username
        document.getElementById("show_created").innerText = button.dataset.created
        document.getElementById("show_title").innerText = button.dataset.title
        document.getElementById("show_text").innerText = button.dataset.text
        document.getElementById("show").style.display = 'block'
        document.getElementById("deleteForm").action = url
    }

    function deleteComment(url){
        document.getElementById("deleteForm").action = url
        openModal()
    }

    function openModal() {
        const modal = document.getElementById('deleteModal');
        const form = document.getElementById('deleteForm');
        modal.style.display = 'flex';
    }

    function closeModal() {
        document.getElementById('deleteModal').style.display = 'none';
    }

    function submitForm() {
        document.getElementById('comment-delete').submit();
    }
    
</script>
<style>
    #deleteModal {
        position: fixed;
        top: 0;
        left: 0;
        width: 100vw;
        height: 100vh;
        background: rgba(0, 0, 0, 0.5);
        display: none;
        justify-content: center;
        align-items: center;
        z-index: 9999;
    }
    
    .modal-content {
        background-color: white;
        padding: 20px;
        border-radius: 10px;
        width: 300px;
        max-width: 90%;
        box-shadow: 0 0 15px rgba(0,0,0,0.3);
        position: relative;
    }

    .close {
        position: absolute;
        top: 10px;
        right: 15px;
        font-size: 28px;
        font-weight: bold;
        cursor: pointer;
    }
</style>
{% endblock %}